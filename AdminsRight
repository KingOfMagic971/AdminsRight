# AdminsRight
–ú–æ–¥—É–ª—å –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —É–¥–æ–±–Ω–æ –Ω–∞–∑–Ω–∞—á–∞—Ç—å 
# -*- coding: utf-8 -*-
# meta developer: @Gosgrrr
# scope: hikka_only

from .. import loader, utils
import asyncio

@loader.tds
class AdminRightsConfigMod(loader.Module):
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω-–ø—Ä–µ—Å–µ—Ç–∞–º–∏"""
    strings = {"name": "AdminRightsConfig"}

    async def admincmd(self, message):
        """[preset] [username/id/reply] [rank] - –ø–æ–∫–∞–∑–∞—Ç—å –∏–ª–∏ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–µ—Å–µ—Ç"""
        args = utils.get_args(message)
        
        if not args:
            # –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
            await message.edit(self._get_rights_text())
            return

        if len(args) < 3:
            await message.edit("‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: .admin [preset] [username/id/reply] [rank]")
            return

        preset = args[0]
        user = None
        rank = " ".join(args[2:])

        # —é–∑–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–ø–ª–∞–µ–º –∏–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º
        if message.is_reply:
            reply = await message.get_reply_message()
            user = await message.client.get_entity(reply.sender_id)
        else:
            try:
                user = await message.client.get_entity(args[1])
            except Exception:
                await message.edit("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.")
                return

        # —Ç—É—Ç –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∞–≤–∞ –∏–∑ –±–∞–∑—ã
        rights = self._load_preset(preset)
        if not rights:
            await message.edit(f"‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ¬´{preset}¬ª –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
            return

        await message.edit(f"üõ° {utils.escape_html(user.first_name)} –Ω–∞–∑–Ω–∞—á–µ–Ω(–∞) –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å –∑–≤–∞–Ω–∏–µ–º ¬´{rank}¬ª.")

    async def unadmincmd(self, message):
        """[username/id/reply] - —Å–Ω—è—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∞ –∏ –∑–≤–∞–Ω–∏–µ"""
        args = utils.get_args(message)

        user = None
        if message.is_reply:
            reply = await message.get_reply_message()
            user = await message.client.get_entity(reply.sender_id)
        elif args:
            try:
                user = await message.client.get_entity(args[0])
            except Exception:
                await message.edit("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.")
                return
        else:
            await message.edit("‚ùå –£–∫–∞–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (username/id/reply).")
            return

        await message.edit(f"‚úÖ **–í—Å–µ –ø—Ä–∞–≤–∞ –∏ –∑–≤–∞–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {utils.escape_html(user.first_name)} —É—Å–ø–µ—à–Ω–æ —Å–Ω—è—Ç—ã.**")

    # –ø—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–π-–∑–∞–≥–ª—É—à–µ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π
    def _get_rights_text(self):
        return "üîÑ –¢—É—Ç —Å–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤ –±—É–¥–µ—Ç (–ø—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∫ —Ä–∞–Ω—å—à–µ)."

    def _load_preset(self, name):
        # –∑–∞–≥–ª—É—à–∫–∞: –Ω—É–∂–Ω–æ –ø–æ–¥—Ä—É–±–∏—Ç—å SQLite –∫–∞–∫ —É —Ç–µ–±—è –≤—ã—à–µ
        # –≤–µ—Ä–Ω—ë—Ç —Å–ª–æ–≤–∞—Ä—å —Å –ø—Ä–∞–≤–∞–º–∏
        return {"ban": True, "invite": True, "pin": False}